```{r echo = FALSE, warning = FALSE, message=FALSE}
source("init.R")
```

# Template chapter {#sec-temp}

*Last modified on `r format(fs::file_info("template-chapter.qmd")$modification_time, '%d. %B %Y at %H:%M:%S')`*

> *"A quote." --- Dan Meyer*

## General background

```{r}
set.seed(20251226) #20251226
cor_high_tbl <- tibble(weight = abs(rnorm(5, 3, 4)),
                       jumplength = 10 + 1 * weight + rnorm(5, 0, 4)) |> 
  mutate(sweight = weight - mean(weight),
         sjump = jumplength - mean(jumplength),
         ss_xy = sweight * sjump,
         ss_x = sweight^2,
         ss_y = sjump^2,
         sign_xy = ifelse(sign(ss_xy) == -1, "\U2012", "+"))
set.seed(202511)

sum(cor_high_tbl$ss_x)
sum(cor_high_tbl$ss_x) |> sqrt()
sum(cor_high_tbl$ss_y)
sum(cor_high_tbl$ss_y) |> sqrt()
sum(cor_high_tbl$ss_xy)

```

```{r}
cor(cor_high_tbl$weight, cor_high_tbl$jumplength)
```

```{r}
cov(cor_high_tbl$weight, cor_high_tbl$jumplength)
```

```{r}
lm_fit <- lm(jumplength ~ weight, data = cor_high_tbl)
```

```{r}
vcov(lm_fit)
```






```{r}
#| message: false
#| echo: false
#| warning: false
#| fig-align: center
#| fig-height: 5
#| fig-width: 9
#| fig-cap: "foo"
#| label: fig-corr-theo-example

geom_spit_tile <- function(x, y, a, b, weight, color, fill) {
  a <- a*weight
  b <- b*weight
  x <- x - b/2
  y <- y - a/2
  list(  
    geom_shape(data = tibble(x = c(x, x+b-0.01, x), 
                             y = c(y+0.01, y+a, y+a)),
               aes(x, y), color = color[1], fill = fill[1], alpha = 0.2),
    geom_shape(data = tibble(x = c(x+0.01, x+b, x+b), 
                             y = c(y, y, y+a-0.01)),
               aes(x, y), color = color[2], fill = fill[2], alpha = 0.2)    
  ) 
}

cor_high_tbl |> 
  ggplot(aes(x = weight, y = jumplength)) +
  theme_book() +
  coord_equal() +
  annotate("segment", x = rep(-1, 7), xend = rep(11, 7),
           y = c(10, 12, 14, 16, 18, 20, 22), 
           yend = c(10, 12, 14, 16, 18, 20, 22),
           color = "gray95") +
  geom_vline(xintercept = c(0,5,10), color = "gray95") +
  geom_segment(x = -1, xend = 10.5, 
               y = mean(cor_high_tbl$jumplength), 
               yend = mean(cor_high_tbl$jumplength), color = "#0D0887FF", linetype = 11) +
  annotate("text", x = 10.75, y = mean(cor_high_tbl$jumplength), 
           hjust = "left", label = expression(bold(bar(y))),
           size = 5, color = "#0D0887FF") +   
  geom_segment(aes(x = mean(cor_high_tbl$weight), xend = weight,
                   y = jumplength, yend = jumplength), color = "#B12A90FF", size = 1) +
  geom_segment(x = mean(cor_high_tbl$weight), 
               xend = mean(cor_high_tbl$weight), 
               y = 7, yend = 22.5, color = "#B12A90FF", linetype = 11) +
  annotate("text", x = mean(cor_high_tbl$weight), y = 23, 
           hjust = "center", label = expression(bold(bar(x))),
           size = 5, color = "#B12A90FF") +   
  geom_segment(aes(y = mean(cor_high_tbl$jumplength), yend = jumplength,
                   x = weight, yend = weight), color = "#0D0887FF", size = 1) +
  geom_point(size = 2) +
  scale_x_continuous(breaks = c(0,5,10), limits = c(NA, 33),
                     expand = expand_scale(mult = 0)) +
  scale_y_continuous(breaks = c(10, 12, 14, 16, 18, 20, 22),
                     labels = c("10", "12", "14", "16", "18", "20", "22"),
                     limits = c(9, 23)) +
  labs(x = str_pad("Cat flea weight in [mg]", 142.5, "right"), y = "Jump length in [cm]") +
  scale_color_viridis(discrete = TRUE, option = "plasma", end = 0.9) +
  ## upper right
  annotate("text", x = 14.5, y = 19.5, hjust = "right", label = expression(S[xy]~"="),
            size = 5) + 
  geom_shape(data = tibble(x = c(15, 33, 33, 15), 
                           y = c(16.25, 16.25, 23, 23)),
             aes(x, y), radius = unit(0.2, 'cm'), fill = "gray95") +
  annotate("text", x = 32.75, y = 22.25, label = expression(sum()*33.21), size = 5,
           hjust = "right") +
  annotate("text", x = 15.25, y = 22.25, label = expression(bold(SS[xy])), size = 5,
           hjust = "left") +
  geom_spit_tile(x = c(18), y = c(19.5), 
                 b = cor_high_tbl$sweight[1], a = cor_high_tbl$sjump[1], weight = 1,
                 color = c("#0D0887FF", "#B12A90FF"), fill = c("#0D088780", "#B12A9080")) +
  geom_spit_tile(x = c(22), y = c(19.5), 
                 b = cor_high_tbl$sweight[2], a = cor_high_tbl$sjump[2], weight = 1,
                 color = c("#0D0887FF", "#B12A90FF"), fill = c("#0D088780", "#B12A9080")) +
  geom_spit_tile(x = c(25), y = c(19.5), 
                 b = cor_high_tbl$sweight[3], a = cor_high_tbl$sjump[3], weight = 1,
                 color = c("#0D0887FF", "#B12A90FF"), fill = c("#0D088780", "#B12A9080")) +
  geom_spit_tile(x = c(27), y = c(19.5), 
                 b = cor_high_tbl$sweight[4], a = cor_high_tbl$sjump[4], weight = 1,
                 color = c("#0D0887FF", "#B12A90FF"), fill = c("#0D088780", "#B12A9080")) +
  geom_spit_tile(x = c(30), y = c(19), 
                 b = cor_high_tbl$sweight[5], a = cor_high_tbl$sjump[5], weight = 1,
                 color = c("#0D0887FF", "#B12A90FF"), fill = c("#0D088780", "#B12A9080")) +
  annotate("text", x = c(18, 22, 25, 27, 30), y = c(19.5, 19.5, 19.5, 19.5, 19), 
           label = round(cor_high_tbl$ss_xy, 2), fontface = 2, size = 4.5) +
  annotate("text", x = 30, y = 23.25, label = expression(sum()*33.21), size = 4.5,
           hjust = "right") +
#  annotate("text", x = 14.25, y = 23.25, label = expression(bold(SS[xy])), size = 4.5,
#           hjust = "left") +
  annotate("label", x = c(0, 0, 10, 10), y = c(10, 22, 10, 22),
            label = c("+", "\U2012", "\U2012", "+"), size = 6, fontface = 2,
           fill = "gray95") +
  geom_spit_tile(x = c(20), y = c(12.75), 
                 b = 5.76, a = 5.76, weight = 1,
                 color = c("#0D0887FF", "#B12A90FF"), fill = c("#0D088780", "#B12A9080")) + 
  annotate("text", x = 14.5, y = 9.5, hjust = "right", label = expression("="),
            size = 5) +   
  annotate("text", x = 20, y = 12.75, label = "33.21", fontface = 2, size = 4.5) +
  annotate("segment", x = 15, xend = 25, y = 9.5, yend = 9.5) +
  annotate("text", x = 20, y = 9, label = expression(5-1), size = 5) +
  annotate("text", x = 25.5, y = 9.5, hjust = "left", label = expression("= 8.30"),
            size = 5) + 
  theme(panel.grid = element_blank())

```



## Theoretical background

## R packages used

## Data

## Alternatives 

Further tutorials and R packages on XXX

## Glossary

term

: what does it mean.

## The meaning of "Models of Reality" in this chapter.

- itemize with max. 5-6 words

## Summary

## References {.unnumbered}