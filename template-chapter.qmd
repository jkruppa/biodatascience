```{r echo = FALSE, warning = FALSE, message=FALSE}
source("init.R")
```

# Template chapter {#sec-temp}

*Last modified on `r format(fs::file_info("template-chapter.qmd")$modification_time, '%d. %B %Y at %H:%M:%S')`*

> *"A quote." --- Dan Meyer*

## General background

```{r}
#| message: false
#| warning: false

r2_good_tbl <- tibble(weight = abs(rnorm(5, 3, 4)),
                      jumplength = 10 + 1.2 * weight + rnorm(5, 0, 3))

r2_good_fit <- lm(jumplength ~ weight, data = r2_good_tbl)

mean_good_cat_jump <- mean(r2_good_tbl$jumplength)

r2_good_plot_tbl <- r2_good_tbl |> 
  mutate(sy = jumplength - mean(jumplength),
         e = residuals(r2_good_fit))

sum_good_sy <- (r2_good_plot_tbl$sy)^2 |> abs() |> sum() |> round(2)
sum_good_e <- (r2_good_plot_tbl$e)^2 |> abs() |> sum() |> round(2)
r2_good <- 1-(sum_good_e/sum_good_sy)


r2_bad_tbl <- tibble(weight = r2_good_tbl$weight,
                     jumplength = 9 + 0.5 * weight + rnorm(5, 0, 4))

r2_bad_fit <- lm(jumplength ~ weight, data = r2_bad_tbl)

mean_bad_cat_jump <- mean(r2_bad_tbl$jumplength)

r2_bad_plot_tbl <- r2_bad_tbl |> 
  mutate(sy = jumplength - mean(jumplength),
         e = residuals(r2_bad_fit),
         e2 = e^2)

sum_bad_sy <- (r2_bad_plot_tbl$sy)^2 |> abs() |> sum() |> round(2)
sum_bad_e <- (r2_bad_plot_tbl$e)^2 |> abs() |> sum() |> round(2)
r2_bad <- 1-(sum_bad_e/sum_bad_sy)
```

```{r}
#| message: false
#| echo: false
#| warning: false
#| fig-align: center
#| fig-height: 7.5
#| fig-width: 9
#| fig-cap: "foo"
#| label: fig-r2-example

p_r2_good <- r2_good_plot_tbl |> 
  ggplot(aes(x = weight, y = jumplength)) +
  theme_book() +
  coord_equal() +
  annotate("segment", x = rep(-1, 7), xend = rep(11, 7),
           y = c(8, 10, 12, mean_good_cat_jump, 16, 18, 20), 
           yend = c(8, 10, 12, mean_good_cat_jump, 16, 18, 20),
           color = "gray95") +
  geom_vline(xintercept = c(0,5,10), color = "gray95") +
  geom_tile(aes(x = weight - sy/2, 
                y = jumplength - sy/2, 
                width = sy, height = sy), fill = "#FCA63680",
            alpha = 0.2, color = "#FCA636FF", linewidth = 0.5) +
  geom_segment(x = -1, xend = 11, 
               y = mean_good_cat_jump, yend = mean_good_cat_jump, color = "#B12A90FF", size = 1) +
  annotate("text", x = 11.5, y = mean_good_cat_jump, hjust = "left", label = expression(bold(bar(y))),
           size = 5, color = "#B12A90FF") + 
  geom_tile(aes(x = weight - e/2, 
                y = jumplength - e/2, 
                width = e, height = e), fill = "#0D088780",
            alpha = 0.2, color = "#0D0887FF", linewidth = 0.5) +
  geom_point() +
  geom_line(aes(y = predict(r2_good_fit)), color = "#0D0887FF", size = 1) +
  annotate("text", x = 17, y = 15, hjust = "right", label = expression(R^2~"="~1~"\u2013"),
           size = 6) +
  geom_shape(data = tibble(x = c(17.5, 30, 30, 17.5), 
                           y = c(15.5, 15.5, 19.75, 19.75)),
             aes(x, y), radius = unit(0.2, 'cm'), fill = "gray95") +
  geom_shape(data = tibble(x = c(17.5, 30, 30, 17.5), 
                           y = c(14.5, 14.5, 7.75, 7.75)),
             aes(x, y), radius = unit(0.2, 'cm'), fill = "gray95") +
  annotate("text", x = 29.5, y = 19, label = expression(sum()*14.94), size = 5,
           hjust = "right") +
  geom_tile(aes(x = c(19, 21, 23, 25, 27), 
                y = c(17, 17, 17, 17, 17), 
                width = e, height = e), fill = "#0D088780",
            alpha = 0.2, color = "#0D0887FF", linewidth = 0.5) +
  annotate("segment", x = 17.5, xend = 30, y = 15, yend = 15) +
  geom_tile(aes(x = seq(20.5, 27, length.out =5), 
                y = c(11.5, 11.5, 11.5, 11.5, 11.5), 
                width = sy, height = sy), fill = "#FCA63680",
            alpha = 0.2, color = "#FCA636FF", linewidth = 0.5) +
  annotate("text", x = 29.5, y = 8.5, label = expression(sum()*105.52), size = 5,
           hjust = "right") +
  annotate("text", x = 30.5, y = 15, hjust = "left", label = expression("= 0.86"),
           size = 6) +
  scale_x_continuous(breaks = c(0,5,10), limits = c(NA, 34),
                     expand = expand_scale(mult = 0)) +
  scale_y_continuous(breaks = c(8, 10, 12, mean_good_cat_jump, 16, 18, 20),
                     labels = c("8", "10", "12", round(mean_good_cat_jump, 1), "16", "18", "20"),
                     limits = c(NA, NA)) +
  labs(x = str_pad("Cat flea weight [mg]", 122.5, "right"), y = "Jump length in [cm]") +
  scale_color_viridis(discrete = TRUE, option = "plasma", end = 0.9) +
  theme(panel.grid = element_blank())

p_r2_bad <- r2_bad_plot_tbl |> 
  ggplot(aes(x = weight, y = jumplength)) +
  theme_book() +
  coord_equal() +
  annotate("segment", x = rep(-1, 7), xend = rep(11, 7),
           y = c(8, 10, 12, mean_bad_cat_jump, 16, 18, 20), 
           yend = c(8, 10, 12, mean_bad_cat_jump, 16, 18, 20),
           color = "gray95") +
  geom_vline(xintercept = c(0,5,10), color = "gray95") +
  geom_tile(aes(x = weight - sy/2, 
                y = jumplength - sy/2, 
                width = sy, height = sy), fill = "#FCA63680",
            alpha = 0.2, color = "#FCA636FF", linewidth = 0.5) +
  geom_segment(x = -1, xend = 11, 
               y = mean_bad_cat_jump, yend = mean_bad_cat_jump, color = "#B12A90FF", size = 1) +
  annotate("text", x = 11.5, y = mean_bad_cat_jump, hjust = "left", label = expression(bold(bar(y))),
           size = 5, color = "#B12A90FF") + 
  geom_tile(aes(x = weight - e/2, 
                y = jumplength - e/2, 
                width = e, height = e), fill = "#0D088780",
            alpha = 0.2, color = "#0D0887FF", linewidth = 0.5) +
  geom_point() +
  geom_line(aes(y = predict(r2_bad_fit)), color = "#0D0887FF", size = 1) +
  annotate("text", x = 17, y = 15, hjust = "right", label = expression(R^2~"="~1~"\u2013"),
           size = 6) +
  geom_shape(data = tibble(x = c(17.5, 30, 30, 17.5), 
                           y = c(15.5, 15.5, 19.75, 19.75)),
             aes(x, y), radius = unit(0.2, 'cm'), fill = "gray95") +
  geom_shape(data = tibble(x = c(17.5, 30, 30, 17.5), 
                           y = c(14.5, 14.5, 7.75, 7.75)),
             aes(x, y), radius = unit(0.2, 'cm'), fill = "gray95") +
  annotate("text", x = 29.5, y = 19, label = expression(sum()*4.64), size = 5,
           hjust = "right") +
  geom_tile(aes(x = c(19, 21, 23, 25, 27), 
                y = c(17, 17, 17, 17, 17), 
                width = e, height = e), fill = "#0D088780",
            alpha = 0.2, color = "#0D0887FF", linewidth = 0.5) +
  annotate("segment", x = 17.5, xend = 30, y = 15, yend = 15) +
  geom_tile(aes(x = seq(20.5, 27, length.out =5), 
                y = c(11.5, 11.5, 11.5, 11.5, 11.5), 
                width = sy, height = sy), fill = "#FCA63680",
            alpha = 0.2, color = "#FCA636FF", linewidth = 0.5) +
  annotate("text", x = 29.5, y = 8.5, label = expression(sum()*6.43), size = 5,
           hjust = "right") +
  annotate("text", x = 30.5, y = 15, hjust = "left", label = expression("= 0.28"),
           size = 6) +
  scale_x_continuous(breaks = c(0,5,10), limits = c(NA, 34),
                     expand = expand_scale(mult = 0)) +
  scale_y_continuous(breaks = c(8, 10, 12, mean_bad_cat_jump, 16, 18, 20),
                     labels = c("8", "10", "12", round(mean_bad_cat_jump, 1), "16", "18", "20"),
                     limits = c(NA, NA)) +
  labs(x = str_pad("Cat flea weight [mg]", 122.5, "right"), y = "Jump length in [cm]") +
  scale_color_viridis(discrete = TRUE, option = "plasma", end = 0.9) +
  theme(panel.grid = element_blank())

p_r2_good + p_r2_bad + 
  plot_layout(ncol = 1) +
  plot_annotation(tag_levels = 'A', tag_prefix = '(', tag_suffix = ')') &
  theme(plot.tag = element_text(size = 16, face = "bold"))
```


```{r}
#| message: false
#| echo: false
#| warning: false
#| eval: false
#| fig-align: center
#| fig-height: 4.5
#| fig-width: 7.5
#| fig-cap: "foo"
#| label: fig-var-2-example

p1_corr <- jump_weight_plot_tbl |> 
  ggplot(aes(x = weight, y = jumplength)) +
  theme_book() +
  coord_equal() +
  geom_point() +
  labs(x = "Cat flea weight [mg]", y = "Jump length in [cm]") +
  geom_tile(aes(x = weight - sx/2, 
                y = jumplength - sx/2, 
                width = sx, height = sx), fill = "#FCA63680",
            alpha = 0.2, color = "#FCA636FF", linewidth = 0.5) 

p2_corr <- jump_weight_plot_tbl |> 
  ggplot(aes(x = weight, y = jumplength)) +
  theme_book() +
  coord_equal() +
  geom_point() +
  labs(x = "Cat flea weight [mg]", y = "Jump length in [cm]") +
  geom_tile(aes(x = weight - sy/2, 
                y = jumplength - sy/2, 
                width = sy, height = sy), fill = "#B12A9080",
            alpha = 0.2, color = "#B12A90FF", linewidth = 0.5)

p1_corr + p2_corr + 
  plot_layout(ncol = 2) +
  plot_annotation(tag_levels = 'A', tag_prefix = '(', tag_suffix = ')') &
  theme(plot.tag = element_text(size = 16, face = "bold"))

jump_weight_plot_tbl |> 
  ggplot(aes(x = weight, y = jumplength)) +
  theme_book() +
  coord_equal() +
  geom_point() +
  labs(x = "Cat flea weight [mg]", y = "Jump length in [cm]") +
  geom_tile(aes(x = weight - sx/2, 
                y = jumplength - sy/2, 
                width = sx, height = sy), fill = "#B12A9080",
            alpha = 0.2, color = "#B12A90FF", linewidth = 0.5)

```




## Theoretical background

## R packages used

## Data

## Alternatives 

Further tutorials and R packages on XXX

## Glossary

term

: what does it mean.

## The meaning of "Models of Reality" in this chapter.

- itemize with max. 5-6 words

## Summary

## References {.unnumbered}