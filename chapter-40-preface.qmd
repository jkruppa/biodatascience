```{r echo = FALSE, warning = FALSE, message=FALSE}
source("init.R")
pacman::p_load(tidyverse)
```

# Visualisation of data 

*Last modified on `r format(fs::file_info("chapter-40-preface.qmd")$modification_time, '%d. %B %Y at %H:%M:%S')`*

> *"What problem have you solved, ever, that was worth solving where you knew all the given information in advance? No problem worth solving is like that. In the real world, you have a surplus of information and you have to filter it, or you don't have sufficient information and you have to go find some." --- [Dan Meyer in  Math class needs a makeover](https://www.ted.com/talks/dan_meyer_math_class_needs_a_makeover?language=en&subtitle=en&trigger=5s)*

Here comes the preface text

```{r}
#| message: false
#| echo: false
#| warning: false
#| fig-align: center
#| fig-height: 14
#| fig-width: 11
#| fig-cap: "foo"
#| label: fig-reg-cross


geom_coord_cross <- function(x, y, yticks = "numeric", xticks = "numeric", zero = FALSE) {
  list(
    annotate("segment", x = x-0.2, xend = x+4, y = y, yend = y,
             arrow = arrow(length = unit(0.0075, "npc"), type = "closed")),
    annotate("segment", x = x, xend = x, y = y-0.2, yend = y+4,
             arrow = arrow(length = unit(0.0075, "npc"), type = "closed")),
    if(yticks == "numeric") {
      if(zero){
        list(
          annotate("segment", x = x-0.1, xend = x, y = y + seq(0, 3.5, 0.5), yend = y+ seq(0, 3.5, 0.5)),
          annotate("text", x = x -0.25, y = y + seq(0, 3.5, 0.5), label = seq(0, 70, 10),
                   hjust = "right"),
          annotate("text", x = x - 1, y = y +2, label = c("Count of hairleg"), fontface = 2, size = 5,
                   angle = 90)
        )
      } else {
        list(
          annotate("segment", x = x-0.1, xend = x, y = y + seq(0, 3.5, 0.5), yend = y+ seq(0, 3.5, 0.5)),
          annotate("text", x = x -0.25, y = y + seq(0.5, 3.5, 0.5), 
                   label = round(seq(15, 40, length.out = 7)), hjust = "right") ,
          annotate("text", x = x - 1, y = y +2, label = c("Jump length"), fontface = 2, size = 5, 
                   angle = 90)
        )        
      }
    },
    if(xticks == "numeric") {
      list(
        annotate("segment", x = x+ seq(0, 3.5, 0.5), xend = x+ seq(0, 3.5, 0.5), y = y -0.1 , yend = y),
        annotate("text", x = x +seq(0.5, 3.5, 0.5), y = y -0.35, label = seq(0.5, 3.5, 0.5)),
        annotate("text", x = x + 2, y = y -1, label = c("Weight"), fontface = 2, size = 5)
      )
    },
    if(yticks == "3lvl") {
      list(
        annotate("segment", x = x-0.1, xend = x, y = y + c(1,2,3), yend = y+ c(1,2,3)),
        annotate("text", x = x -0.25, y = y + c(1,2,3), label = c("1", "2", "3"), hjust = "right") ,
        annotate("text", x = x - 1, y = y +2, label = c("Grade"), fontface = 2, size = 5, angle = 90)
      )
    },
    if(xticks == "3lvl") {
      list(
        annotate("segment", x = x + c(1,2,3), xend = x+ c(1,2,3), y = y -0.1 , yend = y),
        annotate("text", x = x + c(1,2,3), y = y -0.35, label = c("dog", "cat", "fox")),
        annotate("text", x = x + 2, y = y -1, label = c("Host"), fontface = 2, size = 5)
      )
    },
    if(yticks == "2lvl") {
      list(
        annotate("segment", x = x-0.1, xend = x, y = y + c(0.5, 3), yend = y+  c(0.5, 3)),
        annotate("text", x = x -0.25, y = y + c(0.5, 3), label = c("0", "1"), hjust = "right") ,
        annotate("text", x = x - 1, y = y +2, label = c("Infected"), fontface = 2, size = 5, angle = 90)
      )
    },
    if(xticks == "2lvl") {
      list(
        annotate("segment", x = x+ c(1.25, 2.75), xend = x+ c(1.25, 2.75), y = y -0.1 , yend = y),
        annotate("text", x = x + c(1.25, 2.75), y = y -0.35, label = c("dog", "cat")),
        annotate("text", x = x + 2, y = y -1, label = c("Host"), fontface = 2, size = 5)

      )
    }
  )
}

ggplot() +
  ##theme_void() +
  theme_minimal() +
  coord_cartesian(xlim = c(-1, 20), ylim = c(0, 27)) +
  scale_x_continuous(breaks = seq(-10, 10, 1)) +
  scale_y_continuous(breaks = seq(0, 10, 1)) +
  annotate("segment", x = c(2, 8, 14, 20), xend = c(2, 8, 14, 20),
           y = c(0, 0, 0, 0), yend = c(27, 25.75, 25.75, 27)) +
  annotate("segment", x = c(-1, 0.25, 0.25, 0.25, -1), xend = c(20, 20, 20, 20, 20),
           y = c(0, 6, 12, 18, 24), yend = c(0, 6, 12, 18, 24)) +
  geom_segment(y = c(0, 6, 12, 18, 24)) +
  scale_x_continuous(breaks = 0:22, expand = expansion(mult = 0)) +
  scale_y_continuous(breaks = 0:28, expand = expansion(mult = 0)) +
  ## outer text
  annotate("text", x = 11, y = 26.5, label = "Characteristic of the influencer (X)", 
           size = 8, fontface = 2) +
  annotate("text", x = c(5, 11, 17), y = 25.25, 
           label = c("Covariate", "Factor", "Factor"), size = 7, fontface = 2) +
  annotate("text", x = c(5, 11, 17), y = 24.5, 
           label = c("X is numeric", "X has 3 or more levels", "X has 2 levels"), 
           size = 6, fontface = 3) +
  annotate("text", x = -0.5, y = 12, label = "Distribution of the outcome (Y)", size = 8, 
           fontface = 2, angle = 90) +
  annotate("text", x = 0.75, y = c(3, 9, 15, 21), 
           label = c("Binomial", "Ordinal", "Poisson", "Normal"), size = 7, fontface = 2, angle = 90) +
  annotate("text", x = 1.5, y = c(3, 9, 15, 21), 
           label = c("X is numeric", "X has 3 or more levels", "X has 2 levels", "bar"), 
           size = 6, fontface = 3, angle = 90) +
  ## coords
  geom_coord_cross(x = 3.5, y = 7.5, yticks = "3lvl", xticks = "numeric") +
  geom_coord_cross(x = 9.5, y = 7.5, yticks = "3lvl", xticks = "3lvl") +
  geom_coord_cross(x = 15.5, y = 7.5, yticks = "3lvl", xticks = "2lvl") +  
## normal
## pois
## ordinal
  annotate("point", x = c(0.45, 0.7, 1.1, 1.25, 1.65, 1.87, 2.15, 2.5, 2.7, 3.2) + 3.5, 
           y = c(8.5, 8.5, 8.5, 9.5, 9.5, 9.5, 9.5, 10.5, 10.5, 10.5), size = 1.5) +
  ### 3lvl 
  annotate("rect", xmin = 10, xmax = 11, ymin = 8, ymax = 8.5, fill = "gray80", color = "black") +
  annotate("rect", xmin = 10, xmax = 11, ymin = 8.5, ymax = 9.5, fill = "gray80", color = "black") +
  annotate("rect", xmin = 10, xmax = 11, ymin = 9.5, ymax = 11, fill = "gray80", color = "black") +
  annotate("rect", xmin = 11, xmax = 12, ymin = 8, ymax = 9.15, fill = "gray80", color = "black") +
  annotate("rect", xmin = 11, xmax = 12, ymin = 9.15, ymax = 9.75, fill = "gray80", color = "black") +
  annotate("rect", xmin = 11, xmax = 12, ymin = 9.75, ymax = 11, fill = "gray80", color = "black") +
  annotate("rect", xmin = 12, xmax = 13, ymin = 8, ymax = 8.15, fill = "gray80", color = "black") +
  annotate("rect", xmin = 12, xmax = 13, ymin = 8.15, ymax = 9.5, fill = "gray80", color = "black") +
  annotate("rect", xmin = 12, xmax = 13, ymin = 9.5, ymax = 11, fill = "gray80", color = "black") +
  ### 2lvl
  annotate("rect", xmin = 16, xmax = 17.5, ymin = 8, ymax = 8.5, fill = "gray80", color = "black") +
  annotate("rect", xmin = 16, xmax = 17.5, ymin = 8.5, ymax = 9.5, fill = "gray80", color = "black") +
  annotate("rect", xmin = 16, xmax = 17.5, ymin = 9.5, ymax = 11, fill = "gray80", color = "black") +
  annotate("rect", xmin = 17.5, xmax = 19, ymin = 8, ymax = 9.15, fill = "gray80", color = "black") +
  annotate("rect", xmin = 17.5, xmax = 19, ymin = 9.15, ymax = 9.75, fill = "gray80", color = "black") +
  annotate("rect", xmin = 17.5, xmax = 19, ymin = 9.75, ymax = 11, fill = "gray80", color = "black")
```

