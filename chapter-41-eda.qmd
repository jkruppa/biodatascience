```{r echo = FALSE, warning = FALSE, message=FALSE}
source("init.R")
```

# Explorative data analysis {#sec-temp}

*Last modified on `r format(fs::file_info("chapter-41-eda.qmd")$modification_time, '%d. %B %Y at %H:%M:%S')`*

> *"A quote." --- Dan Meyer*

## General background

## Theoretical background

```{r}
#| message: false
#| eval: false
#| echo: false
#| warning: false
#| fig-align: center
#| fig-height: 4
#| fig-width: 3
#| fig-cap: "foo"
#| label: fig-mean-dist-theo
ggplot() +
  theme_book() +
  coord_cartesian(xlim = c(0, 5), ylim = c(0, 60)) +
  geom_point(data = jump_dog_tbl, aes(x = 0, y = jumplength), size = 2) +
  geom_path(data = tibble(x_raw = seq(-15, 15, 0.1), 
                          y_raw = dnorm(x_raw, sd = 5)), 
            aes(y = -(x_raw*1.4)+20, x = (y_raw*15)), 
            linewidth = 1, color = "black", angle = 90) 


```


## R packages used

## Data

```{r}
#| message: false
#| warning: false
jump_dog_tbl <- read_delim("data/jump_fleas.txt") |> 
  select(host, jumplength) |> 
  filter(host == "dog") 
```

```{r}
jump_dog_tbl
```


## Mean


```{r}
#| message: false
#| echo: false
#| warning: false
#| fig-align: center
#| fig-height: 4
#| fig-width: 3
#| fig-cap: "foo"
#| label: fig-mean-dist

mean_dog_jump <- mean(jump_dog_tbl$jumplength)
sd_dog_jump <- sd(jump_dog_tbl$jumplength)

ggplot() +
  theme_book() +
  coord_cartesian(xlim = c(-0.5, 1.5), ylim = c(0, 60)) +
  geom_point(data = jump_dog_tbl, aes(x = 0, y = jumplength), size = 2) +
  geom_path(data = tibble(x_raw = seq(mean_dog_jump-mean_dog_jump/1.5, 
                                      mean_dog_jump+mean_dog_jump/1.5, 0.1), 
                          y_raw = dnorm(x_raw, mean = mean_dog_jump, sd = sd_dog_jump)), 
            aes(y = x_raw, x = y_raw*20), 
            linewidth = 1, color = "black", angle = 90) +
  geom_hline(yintercept = mean_dog_jump, color = "#B12A90FF", size = 1) 

```



```{r}
#| message: false
#| echo: false
#| warning: false
#| fig-align: center
#| fig-height: 4
#| fig-width: 7
#| fig-cap: "foo"
#| label: fig-mean-example

mean_dog_jump <- mean(jump_dog_tbl$jumplength)
sd_dog_jump <- sd(jump_dog_tbl$jumplength)


jump_dog_plot_tbl <- jump_dog_tbl |>
  mutate(e = round(jumplength - mean_dog_jump, 1),
         sign = as_factor(ifelse(sign(e) == -1, "\U2012", "+")),
         e_label = str_c(sign, abs(e)))

p1_fig_mean_example <- jump_dog_plot_tbl |> 
  ggplot(aes(x = 1:7, y = jumplength)) +
  theme_book() +
  geom_segment(aes(x = 1:7, xend = 1:7, y = jumplength, yend = mean_dog_jump, 
                   color = sign), show.legend = FALSE, size = 1) +
  geom_text(aes(x = 1:7, y = jumplength - e/2, label = e_label, color = sign),
            size = 4, position = position_nudge(0.3), fontface = 2, show.legend = FALSE) +
  geom_shape(data = tibble(x = c(-0.25, 0.25, 0.25, -0.25), 
                           y = c(19, 19, 44, 44)),
             aes(x, y), radius = unit(0.2, 'cm'), fill = "gray95") +
  geom_hline(yintercept = mean_dog_jump, color = "#B12A90FF", size = 1) +
  geom_point(size = 2) +
  scale_x_continuous(breaks = c(0:7), labels = c("All", 1:7)) +
  scale_y_continuous(breaks = c(25, 30, mean_dog_jump, 35, 40),
                     labels = c("25", "30", round(mean_dog_jump,1), "35", "40")) +
  labs(x = "Dog flea ID", y = "Jump length in [cm]") +
  scale_color_viridis(discrete = TRUE, option = "plasma", end = 0.9) +
  geom_segment(aes(x = 0.1, xend = (1:7)-0.1, y = jumplength, yend = jumplength),
               linetype = 11, color = "gray50",
               arrow = arrow(length = unit(0.02, "npc"), type = "closed")) +
  geom_shape(data = tibble(x = c(4.6, 5.6, 5.6, 4.6), 
                           y = c(19, 19, 28.5, 28.5)),
             aes(x, y), radius = unit(0.2, 'cm'), fill = "gray95") +
  geom_shape(data = tibble(x = c(5.8, 7.1, 7.1, 5.8), 
                           y = c(19, 19, 28.5, 28.5)),
             aes(x, y), radius = unit(0.2, 'cm'), fill = "gray95") +
  annotate("label", x = 5.1, y = 29, label = "Negative", fontface = 2, 
           fill = "#0D0887FF", alpha = 0.5) +
  annotate("label", x = 6.45, y = 29, label = "Positive", fontface = 2, 
           fill = "#FCCE25FF", alpha = 0.5) +
  geom_segment(data = filter(jump_dog_plot_tbl, sign == "\U2012"),
               aes(x = 4.8 + c(0, 0.3, 0.6), xend = 4.8 + c(0, 0.3, 0.6), 
                   y = (jumplength+20)/2, yend = (mean_dog_jump+20)/2, 
                   color = sign), show.legend = FALSE, size = 1) +
  geom_segment(data = filter(jump_dog_plot_tbl, sign == "+"),
               aes(x = 6 + c(0, 0.3, 0.6, 0.9), xend = 6 + c(0, 0.3, 0.6, 0.9), 
                   y = (jumplength+13)/2, yend = (mean_dog_jump+13)/2, 
                   color = sign), show.legend = FALSE, size = 1) +
  geom_text(data = filter(jump_dog_plot_tbl, sign == "\U2012"),
            aes(x = 4.8 + c(0, 0.3, 0.6), y = (jumplength+20)/2-0.5, 
                label = e_label, color = sign), fontface = 2, show.legend = FALSE, size = 3) +  
  geom_text(data = filter(jump_dog_plot_tbl, sign == "+"),
            aes(x = 6 + c(0, 0.3, 0.6, 0.9), y = (jumplength+13)/2+0.5,  
                label = e_label, color = sign), fontface = 2, show.legend = FALSE, size = 3) + 
  annotate("text", x = 5.7, y = 24, label = "=", size = 6) +
  annotate("text", x = 5.3, y = 20, label = expression(sum()*-17.4), size = 3) +
  annotate("text", x = 6.8, y = 20, label = expression(sum()*+17.4), size = 3) +
  ## right
  geom_point(data = jump_dog_plot_tbl, aes(x = 0, y = jumplength), size = 2) 
p1_fig_mean_example

```


```{r}
#| message: false
#| echo: false
#| warning: false
#| fig-align: center
#| fig-height: 4
#| fig-width: 8
#| fig-cap: "foo"
#| label: fig-mean-example-extend

p2_fig_mean_example <- ggplot() +
  theme_book() +
  coord_cartesian(xlim = c(-0.1, 1.2)) +
  geom_point(data = jump_dog_tbl, aes(x = 0, y = jumplength), size = 2) +
  geom_path(data = tibble(x_raw = seq(mean_dog_jump-mean_dog_jump/1.5, 
                                      mean_dog_jump+mean_dog_jump/1.5, 0.1), 
                          y_raw = dnorm(x_raw, mean = mean_dog_jump, sd = sd_dog_jump)), 
            aes(y = x_raw, x = y_raw*20), 
            linewidth = 1, color = "black", angle = 90) +
  geom_hline(yintercept = mean_dog_jump, color = "#B12A90FF", size = 1) +
  labs(x = "", y = "") +
  scale_y_continuous(breaks = c(25, 30, mean_dog_jump, 35, 40),
                     labels = c("25", "30", round(mean_dog_jump,1), "35", "40")) 


p1_fig_mean_example + p2_fig_mean_example +
  plot_layout(ncol = 2, widths = c(7, 1)) +
  plot_annotation(tag_levels = 'A', tag_prefix = '(', tag_suffix = ')') &
  theme(plot.tag = element_text(size = 16, face = "bold"))
```


```{r}
#| message: false
#| echo: false
#| warning: false
#| fig-align: center
#| fig-height: 4.5
#| fig-width: 9
#| fig-cap: "foo"
#| label: fig-var-example

mean_dog_jump <- mean(jump_dog_tbl$jumplength)

jump_dog_plot_tbl <- jump_dog_tbl |>
  mutate(jump_length = jumplength,
         e = jumplength - mean_dog_jump,
         sign = as_factor(ifelse(sign(e) == -1, "\U2012", "+")))

sum_e_dog_jump <- sum(abs(jump_dog_plot_tbl$e))

jump_dog_plot_tbl |> 
  ggplot(aes(x = 1:7, y = jumplength)) +
  theme_book() +
  coord_equal() +
  annotate("segment", x = rep(-2, 4), xend = rep(14, 4),
           y = c(25, 30, 35, 40), yend = c(25, 30, 35, 40),
           color = "gray95") +
  geom_vline(xintercept = 1:7, color = "gray95") +
  geom_tile(aes(x = 1:7 - e/2, 
                y = jumplength - e/2, 
                width = e, height = e), fill = "#FCA63680",
            alpha = 0.2, color = "#FCA636FF", linewidth = 0.5) +
  geom_shape(data = tibble(x = c(13.8, 46.5, 46.5, 13.8) + 7, 
                           y = c(33.85, 33.85, 46.3, 46.3) - 4),
             aes(x, y), radius = unit(0.2, 'cm'), fill = "gray95") +
  geom_tile(aes(x = c(20, 28.4, 28.4, 31.5, 34, 35, 41.6)+7, 
                y = c(40, 36.7, 42, 42, 37.2, 42, 38.5)-4, 
                width = e, height = e), fill = "#FCA63680",
            alpha = 0.2, color = "#FCA636FF", linewidth = 0.5) +
  geom_text(aes(x = c(20, 28.4, 28.4, 31.5, 34, 35, 41.6)+7, 
                y = c(40, 36.7, 42, 42, 37.2, 42, 38.5)-4, label = round(e^2,1)),
            fontface = 2) +
  annotate("text", x = 50, y = 40.5, label = expression(sum()*258.5), size = 5) +
  annotate("tile", x = 24, y = 21, 
           width = sum_e_dog_jump/7, height = sum_e_dog_jump/7, fill = "#FCA63680",
           alpha = 0.2, color = "#FCA636FF", linewidth = 0.5) +
  annotate("text", x = 24, y = 21, label = "43.08", fontface = 2) +
  annotate("segment", x = 26.4, xend = 26.4, y = 18.5, yend = 23.5, size = 1.5, color = "#E16462FF") +
  annotate("text", x = 32, y = 21, hjust = "left", label = expression(s~"="~6.56),
           size = 5, color = "black") + 
  geom_curve(aes(x = 31.5, y = 21, xend = 26.9, yend = 21),
             arrow = arrow(length = unit(0.02, "npc"), type = "closed"),
             curvature = 0.3, color = "black", lineend = "round") +
  geom_segment(x = -2, xend = 13, 
               y = mean_dog_jump, yend = mean_dog_jump, color = "#B12A90FF", size = 1) +
  annotate("text", x = 13.5, y = 33, hjust = "left", label = expression(bold(bar(y))),
           size = 5, color = "#B12A90FF") + 
  geom_point() +
  scale_x_continuous(breaks = 1:7, limits = c(NA, 54),
                     expand = expand_scale(mult = 0)) +
  scale_y_continuous(breaks = c(25, 30, mean_dog_jump, 35, 40),
                     labels = c("25", "30", round(mean_dog_jump,1), "35", "40"),
                     limits = c(NA, NA)) +
  labs(x = str_pad("Dog flea ID", 140, "right"), y = "Jump length in [cm]") +
  scale_color_viridis(discrete = TRUE, option = "plasma", end = 0.9) +
  annotate("segment", x = 21, xend = 54, y = 29.5, yend = 29.5, size = 0.75) +
  annotate("text", x = 20.5, y = 29.75, hjust = "right", label = expression(s^2~"="),
           size = 5) + 
  annotate("text", x = 37.5, y = 28, hjust = "center", label = expression((7-1)),
           size = 5) + 
  annotate("text", x = 20.5, y = 21, hjust = "right", label = expression(s^2~"="),
           size = 5) + 
  theme(panel.grid = element_blank())
```


## Alternatives 

Further tutorials and R packages on XXX

## Glossary

term

: what does it mean.

## The meaning of "Models of Reality" in this chapter.

- itemize with max. 5-6 words

## Summary

## References {.unnumbered}