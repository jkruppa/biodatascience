```{r echo = FALSE, warning = FALSE}
source("init.R")
```

# Fleas of animals {#sec-data-examples}

*Last modified on `r format(fs::file_info("chapter-12-factorial-data.qmd")$modification_time, '%d. %B %Y at %H:%M:%S')`*

> *"A quote." --- Dan Meyer*

## General background

What is a data grid?

## Theoretical background

## R packages used

```{r}
#| message: false
#| warning: false
pacman::p_load(tidyverse, conflicted)
```


@wickham2023r

## Data

Small data

### Jump performances of fleas

@cadiergues2000comparison


*C. felis felis* jump was $19.9 \pm 9.1cm$ with a range from $2$ to $48cm$ 

*C. canis* jump was longer $30.4 \pm 9.1cm$  with a range from $3$ to $50cm$

```{r}
jump_flea_tbl <- tibble(host = rep(0:1, each = 7),
                        jump_length = 19.9 + 10.5 * host + rnorm(14, 0, 9.1)) |> 
  mutate(host = factor(host, labels = c("cat", "dog")))
```

```{r}
expand_grid(host = c("cat", "dog"), rep = 1:7)
```



```{r}
jump_flea_tbl |> 
  group_by(host) |> 
  summarise(mean(jump_length),
            sd(jump_length)) |> 
  mutate_if(is.numeric, round, 2)
```
```{r}
#| echo: false
#| message: false
#| warning: false
#| label: fig-chap-11-fac-01
#| fig-align: center
#| fig-height: 3.5
#| fig-width: 7
#| fig-cap: "foo **(A)** foo **(B)** foo"

jump_flea_tbl |> 
  ggplot(aes(x = host, y = jump_length, fill = host)) +
  theme_book() +
  geom_point(position = position_nudge(-0.075),
             show.legend = FALSE, shape = 21) +
  stat_summary(fun.data=mean_sdl, fun.args = list(mult = 1), 
               geom="pointrange", shape = 23, size = 1,
               show.legend = FALSE) +
  stat_summary(fun = mean, geom = "label", aes(label = round(..y..,2)),
               size = 4, position = position_nudge(x = 0.05), alpha = 0.5,
               show.legend = FALSE, hjust = "left") +
  labs(x = "Flea host", y = "Jump length in [cm]",
       fill = "Host") +
  scale_fill_viridis(discrete = TRUE, option = "plasma")
```

```{r}
jump_animals_tbl <- tibble(cat = rnorm(n = 7, mean = 19.9, sd = 9.1),
                           fox = rnorm(n = 7, mean = 35.2, sd = 10.3),
                           rat = rnorm(n = 7, mean = 15.2, sd = 4.6),
                           dog = rnorm(n = 7, mean = 30.4, sd = 9.1)) |>
  pivot_longer(cols = cat:dog, values_to = "jump_length", names_to = "host") |> 
  mutate(host = as_factor(host))
```

```{r}
jump_animals_tbl |> 
  group_by(host) |> 
  summarise(mean(jump_length),
            sd(jump_length)) |> 
  mutate_if(is.numeric, round, 2)
```

```{r}
#| echo: false
#| message: false
#| warning: false
#| label: fig-chap-11-fac-02
#| fig-align: center
#| fig-height: 3.5
#| fig-width: 7
#| fig-cap: "foo **(A)** foo **(B)** foo"

jump_animals_tbl |> 
  ggplot(aes(x = host, y = jump_length, fill = host)) +
  theme_book() +
  geom_point(position = position_nudge(-0.075),
             show.legend = FALSE, shape = 21) +
  stat_summary(fun.data=mean_sdl, fun.args = list(mult = 1), 
               geom="pointrange", shape = 23, size = 1,
               show.legend = FALSE) +
  stat_summary(fun = mean, geom = "label", aes(label = round(..y..,2)),
               size = 4, position = position_nudge(x = 0.075), alpha = 0.5,
               show.legend = FALSE, hjust = "left") +
  labs(x = "Flea host", y = "Jump length in [cm]",
       fill = "Host") +
  scale_fill_viridis(discrete = TRUE, option = "plasma")
```


### Measurements on animal fleas

- Jump length in [cm] called `jump_length`
- Number of hairs on each leg called `count_leg_left` and `count_leg_right`
- Ratings of each flea, as listed in the catalog of the Fédération Internationale de la Beauté des Puces (FIBP) called `rating` on a Likert scale from 1 to 5, with 5 being the strongest expression.
- The infection status with the flea cold is called `infected`, with a value of 0/1 for no/yes.

```{r}
tibble(jump_length = rnorm(7, 5, 1),
       count_right_leg = rpois(7, 4),
       count_left_leg = rpois(7, 4),
       count_leg = (count_left_leg + count_right_leg)/2,
       rating = sample(1:5, 7, replace = TRUE, prob = c(0.1, 0.2, 0.4, 0.2, 0.1)),
       infectd = rbinom(7, prob = 0.5, size = 1))
```


### Fleas in urban and rural habitats

Why so complex?

@rpkg_purrr

```{r}
jump_habitat_eff_grid <- expand_grid(host = 1:3, site = 1:2) |> 
  mutate(mean_host = c(19.9, 19.9, 30.4, 30.4, 15.2, 15.2),
         mean_site = c(2, 5, 2, 5, 5, -5),
         mean = mean_host + mean_site,
         sd_host = c(9.1, 9.1, 9.1, 9.1, 4.6, 4.6),
         sd_site = c(0.3, 0.5, 0.3, 0.5, 0.3, 0.5),
         sd = sd_host + sd_site)
jump_habitat_eff_grid
```


```{r}
jump_habitat_raw_tbl <- jump_habitat_eff_grid |> 
  group_by(host, site) |> nest() |> 
  mutate(jump_length = map(data, ~rnorm(5, .x$mean, .x$sd))) |> 
  unnest(c(host, site, jump_length)) |> ungroup()
```

```{r}
jump_habitat_tbl <- jump_habitat_raw_tbl |> 
  select(host, site, jump_length) |> 
  mutate(host = factor(host, labels = c("cat", "dog", "rat")),
         site = factor(site, labels = c("urban", "rural"))) |> 
  mutate_if(is.numeric, round, 2)
```


```{r}
#| warning: false
#| message: false
jump_habitat_tbl |> 
  group_by(host, site) |> 
  summarise(mean(jump_length),
            sd(jump_length)) |> 
  mutate_if(is.numeric, round, 2)
```

```{r}
#| echo: false
#| message: false
#| warning: false
#| label: fig-chap-11-fac-03
#| fig-align: center
#| fig-height: 3.5
#| fig-width: 7
#| fig-cap: "foo **(A)** foo **(B)** foo"

jump_habitat_tbl |> 
  ggplot(aes(x = host, y = jump_length, fill = site)) +
  theme_book() +
  geom_point(position = position_dodge(0.5),
             show.legend = FALSE, shape = 21) +
  stat_summary(fun.data=mean_sdl, fun.args = list(mult = 1), 
               geom="pointrange", shape = 23, size = 1,
               show.legend = TRUE, position = position_dodge(0.9)) +
  stat_summary(fun = mean, geom = "label", aes(label = round(..y..,2)),
               size = 4, position = position_dodge(1.8), 
               alpha = 0.5, show.legend = FALSE) +
  labs(x = "Flea host", y = "Jump length in [cm]",
       fill = "Host") +
  scale_fill_viridis(discrete = TRUE, option = "plasma") 
```

## Data availability

The data is available as txt-Files under <https://github.com/jkruppa/biodatascience>.

```{r}
#| echo: false

jump_animals_tbl |> 
  arrange(host) |> 
  mutate_if(is.numeric, round, 2) |> 
  write_delim("data/jump_animals.txt")

jump_flea_tbl |> 
  arrange(host) |> 
  mutate_if(is.numeric, round, 2) |> 
  write_delim("data/jump_fleas.txt")

jump_habitat_tbl |> 
  arrange(host, site) |> 
  mutate_if(is.numeric, round, 2) |> 
  write_delim("data/jump_habitat.txt")
```



## Alternatives 

Further tutorials and R packages on XXX

## Glossary

term

: what does it mean.

## The meaning of "Models of Reality" in this chapter.

- itemize with max. 5-6 words

## Summary

## References {.unnumbered}