```{r echo = FALSE, warning = FALSE}
source("init.R")
source("images/part_1/part_1_data.R")
```

# Fleas of animals {#sec-data-examples}

*Last modified on `r format(fs::file_info("chapter-12-factorial-data.qmd")$modification_time, '%d. %B %Y at %H:%M:%S')`*

> *"A quote." --- Dan Meyer*

## General background

What is a data grid?

## Theoretical background

```{r}
#| message: false
#| echo: false
#| warning: false
#| fig-align: center
#| fig-height: 4
#| fig-width: 7
#| fig-cap: "foo"
#| label: fig-factorial_data_overview 
p_factorial_data_overview 
```


```{r}
#| message: false
#| echo: false
#| warning: false
#| fig-align: center
#| fig-height: 4
#| fig-width: 7
#| fig-cap: "foo"
#| label: fig-covariate_data_overview 
ggplot() +
  ##theme_minimal() +
  theme_void() +
  coord_cartesian(xlim = c(-11, 11), ylim = c(-3.5, 9.25)) +
  scale_x_continuous(breaks = seq(-10,10,1)) +
  scale_y_continuous(breaks = seq(-10,10,1)) +
#  geom_hline(yintercept = c(-5, 0, 5), color = "gray75") +
 # geom_vline(xintercept = c(-5, 0, 5), color = "gray75") +
  ## lower
  geom_shape(data = tibble(x = c(11.5, 1.5, 1.5, 11.5), 
                           y = c(-4, -4, 2.5, 2.5)),
             aes(x, y), radius = unit(0.5, 'cm'), fill = "gray95") +
  annotate("text", x = 11.5, y = -0.75, label = "VISUALISATION", size = 5, fontface = 2, 
           angle = -90) +
  ## scatter
  annotate("point", x = c(3.5, 4.5, 5.5, 7.5, 8.5, 9.5),
           y = c(1, 0, 1.5, -2.5, -1.5, -0.5)) +
  annotate("segment", x = 3.25, y = 1.5, xend = 10.5, yend = -2.75) +
  annotate("point", x = c(3.5, 4.5, 5.5, 7.5, 8.5, 9.5),
           y = c(1.35, 0.75, 0.2, -1, -1.6, -2.2), shape = 24, fill = "#E16462FF",
           size = 2) +
  annotate("text", x = 8.5, y = 1.5, label = expression(y~"="~41.7-0.8%.%x)) +
  annotate("text", x = 8.5, y = 0.8, label = expression(R^2~"="~0.46)) +
  ### coords
  geom_segment(aes(x = 2.8, xend = 11, y = -3, yend = -3)) +
  geom_segment(aes(x = 3, xend = 3, y = -3.2, yend = 2)) +
  annotate("text", x = c(7), y = c(-3.5), label = c("Weight in [mg]"), 
           fontface =2, size = 3.5) +
  annotate("text", x = c(2.5), y = c(-0.5), label = c("Jump length in [cm]"), 
           angle = 90, fontface =2, size = 3.5) +
  ## upper left
  geom_shape(data = tibble(x = c(-11.5, -1.5, -1.5, -11.5), 
                           y = c(0.5, 0.5, 9.5, 9.5)-2.25),
             aes(x, y), radius = unit(0.5, 'cm'), fill = "gray95") +
  annotate("text", x = -11.5, y = 5-2.25, label = "DATA", size = 5, fontface = 2, 
           angle = 90) +
  geom_segment(aes(x = -11, xend = -2, y = 8-2.25, yend = 8-2.25)) +
  geom_segment(aes(x = -5.75, xend = -5.75, y = 9-2.25, yend = 1-2.25)) +
  geom_segment(aes(x = -8, xend = -8, y = 9-2.25, yend = 1-2.25)) + 
  annotate("text", x = c(-9.5, -6.875, -3.875), y = c(8.5)-2.25,
           label = c("id", "weight", "jumplength"), fontface = 2) + 
  annotate("text", x = c(-9.5), y = c(7.5, 6.5, 5.5, 3.5, 2.5, 1.5)-2.25,
           label = c("Chris", "Charles", "Cameron", "Chloe", "Cora", "Caleb")) +
  annotate("text", x = c(-6.875), y = c(7.5, 6.5, 5.5, 3.5, 2.5, 1.5)-2.25,
           label = c("10.1", "12.4", "15.6", "22.4", "18.1", "25.6")) +
  annotate("text", x = c(-3.875), y = c(7.5, 6.5, 5.5, 3.5, 2.5, 1.5)-2.25,
           label = c("33.2", "31.7", "36.8", "22.1", "19.7", "24.3")) +
  annotate("point", x = c(-9.5, -9.5, -9.5, -6.875, -6.875, -6.875, -3.875, -3.875, -3.875), 
           y = c(4.3, 4.5, 4.7, 4.3, 4.5, 4.7, 4.3, 4.5, 4.7)-2.25, 
           shape = 23, fill = "black", size = 0.5) +
  ## upper right
  geom_shape(data = tibble(x = c(11.5, 1.5, 1.5, 11.5), 
                           y = c(3.5, 3.5, 9.5, 9.5)),
             aes(x, y), radius = unit(0.5, 'cm'), fill = "gray95") +
  annotate("text", x = 11.5, y = 6.5, label = "SUMMARY", size = 5, fontface = 2, 
           angle = -90) +
  geom_segment(aes(x = 11, xend = 2, y = 8, yend = 8)) +
  geom_segment(aes(x = 4.75, xend = 4.75, y = 9, yend = 4)) +
  annotate("text", x = c(3.5, 8), y = c(8.5),
           label = c("Weight", "Model statistics"), fontface = 2) +
  annotate("text", x = c(3.5, 3.5), y = c(7.5, 5.5), 
           label = c(expression(b[0]~"/"~b[1]), expression(hat(y)))) +
  annotate("text", x = c(8), y = c(7.5, 6.5, 5.5, 4.5), 
           label = c(#expression(y~"="~b[0]+b[1]%.%x), 
                     expression(y~"="~41.7-0.8%.%x), 
                     expression(R^2~"="~0.46),
                     "33.7, 31.9, 29.4",
                     "24.0, 27.4, 21.4")) +
  ## curves
  geom_curve(aes(x = -7, y = 7.5, xend = 1.25, yend = 8),
             arrow = arrow(length = unit(0.03, "npc"), type = "closed"),
             curvature = -0.5, color = "black", linewidth = 1.5, lineend = "round") +
  geom_curve(aes(x = 1.25, y = 5, xend = 1.25, yend = -0.75),
             arrow = arrow(length = unit(0.03, "npc"), type = "closed"),
             curvature = 0.5, color = "black", linewidth = 1.5, lineend = "round") 
```



## R packages used

```{r}
#| message: false
#| warning: false
pacman::p_load(tidyverse, conflicted)
```


@wickham2023r

## Data

Small data and grid

### Jump performances of fleas

@cadiergues2000comparison


```{r}
#| echo: false
#| message: false
#| warning: false
#| label: fig-chap-01-flea
#| fig-align: center
#| fig-height: 2
#| fig-width: 7
#| fig-cap: "foo **(A)** foo **(B)** foo"
flea_jump_exp_p
```

*C. felis felis* jump was $19.9 \pm 9.1cm$ with a range from $2$ to $48cm$ 

*C. canis* jump was longer $30.4 \pm 9.1cm$  with a range from $3$ to $50cm$


```{r}
jump_flea_grid <- expand_grid(host = c("cat", "dog")) |> 
  mutate(mean = c(19.9, 30.4), 
         sd = c(9.1))
```

```{r}
jump_flea_tbl <- jump_flea_grid |> 
  rowwise() |> 
  mutate(jumplength = lst(rnorm(7, mean, sd))) |> 
  unnest(cols = jumplength) |> 
  mutate(host = as_factor(host))
```


```{r}
jump_flea_tbl |> 
  group_by(host) |> 
  summarise(mean(jumplength),
            sd(jumplength)) |> 
  mutate_if(is.numeric, round, 2)
```


```{r}
#| echo: false
#| message: false
#| warning: false
#| label: fig-chap-11-fac-01
#| fig-align: center
#| fig-height: 3.5
#| fig-width: 7
#| fig-cap: "foo **(A)** foo **(B)** foo"

jump_flea_tbl |> 
  ggplot(aes(x = host, y = jumplength, fill = host)) +
  theme_book() +
  geom_point(position = position_nudge(-0.075),
             show.legend = FALSE, shape = 21) +
  stat_summary(fun.data=mean_sdl, fun.args = list(mult = 1), 
               geom="pointrange", shape = 23, size = 1,
               show.legend = FALSE) +
  stat_summary(fun = mean, geom = "label", aes(label = round(..y..,2)),
               size = 4, position = position_nudge(x = 0.05), alpha = 0.5,
               show.legend = FALSE, hjust = "left") +
  labs(x = "Flea host", y = "Jump length in [cm]",
       fill = "Host") +
  scale_fill_viridis(discrete = TRUE, option = "plasma") +
  coord_cartesian(ylim = c(0, NA))
```



```{r}
jump_animals_grid <- expand_grid(host = c("cat", "fox", "rat", "dog")) |> 
  mutate(mean = c(19.9, 35.2, 15.2, 30.4), 
         sd = c(9.1, 10.3, 4.6, 9.1))
```

```{r}
jump_animals_tbl <- jump_animals_grid |> 
  rowwise() |> 
  mutate(jumplength = lst(rnorm(7, mean, sd))) |> 
  unnest(cols = jumplength) |> 
  mutate(host = as_factor(host))
```


```{r}
jump_animals_tbl |> 
  group_by(host) |> 
  summarise(mean(jumplength),
            sd(jumplength)) |> 
  mutate_if(is.numeric, round, 2)
```

```{r}
#| echo: false
#| message: false
#| warning: false
#| label: fig-chap-11-fac-02
#| fig-align: center
#| fig-height: 3.5
#| fig-width: 7
#| fig-cap: "foo **(A)** foo **(B)** foo"

jump_animals_tbl |> 
  ggplot(aes(x = host, y = jumplength, fill = host)) +
  theme_book() +
  geom_point(position = position_nudge(-0.075),
             show.legend = FALSE, shape = 21) +
  stat_summary(fun.data=mean_sdl, fun.args = list(mult = 1), 
               geom="pointrange", shape = 23, size = 1,
               show.legend = FALSE) +
  stat_summary(fun = mean, geom = "label", aes(label = round(..y..,2)),
               size = 4, position = position_nudge(x = 0.075), alpha = 0.5,
               show.legend = FALSE, hjust = "left") +
  labs(x = "Flea host", y = "Jump length in [cm]",
       fill = "Host") +
  scale_fill_viridis(discrete = TRUE, option = "plasma") +
  coord_cartesian(ylim = c(0, NA))
```


### Measurements on animal fleas

- Jump length in [cm] called `jump_length`
- Number of hairs on each leg called `count_leg_left` and `count_leg_right`
- Ratings of each flea, as listed in the catalog of the Fédération Internationale de la Beauté des Puces (FIBP) called `rating` on a Likert scale from 1 to 5, with 5 being the strongest expression.
- The infection status with the flea cold is called `infected`, with a value of 0/1 for no/yes.

```{r}
tibble(jumplength = rnorm(7, 5, 1),
       countleg_left = rpois(7, 4),
       countleg_right = rpois(7, 4),
       countleg = (countleg_left + countleg_right)/2,
       rating = sample(1:5, 7, replace = TRUE, prob = c(0.1, 0.2, 0.4, 0.2, 0.1)),
       infectd = rbinom(7, prob = 0.5, size = 1))
```


### Fleas in urban and rural habitats

Why so complex?

@rpkg_purrr

```{r}
jump_habitat_grid <- expand_grid(host = 1:3, site = 1:2) |> 
  mutate(mean_host = c(19.9, 19.9, 30.4, 30.4, 15.2, 15.2),
         mean_site = c(5, 0, 5, 0, 5, -5),
         mean = mean_host + mean_site,
         sd = c(9.1, 9.1, 9.1, 9.1, 4.6, 4.6))
jump_habitat_grid
```

```{r}
jump_habitat_raw_tbl <- jump_habitat_grid |> 
  rowwise() |> 
  mutate(jumplength = lst(rnorm(7, mean, sd))) |> 
  unnest(cols = jumplength)
```



```{r}
jump_habitat_tbl <- jump_habitat_raw_tbl |> 
  select(host, site, jumplength) |> 
  mutate(host = factor(host, labels = c("cat", "dog", "rat")),
         site = factor(site, labels = c("urban", "rural"))) |> 
  mutate_if(is.numeric, round, 2)
```


```{r}
#| warning: false
#| message: false
jump_habitat_tbl |> 
  group_by(host, site) |> 
  summarise(mean(jumplength),
            sd(jumplength)) |> 
  mutate_if(is.numeric, round, 2)
```

```{r}
#| echo: false
#| message: false
#| warning: false
#| label: fig-chap-11-fac-03
#| fig-align: center
#| fig-height: 3.5
#| fig-width: 7
#| fig-cap: "foo **(A)** foo **(B)** foo"

jump_habitat_tbl |> 
  ggplot(aes(x = host, y = jumplength, fill = site)) +
  theme_book() +
  geom_point(position = position_dodge(0.5),
             show.legend = FALSE, shape = 21) +
  stat_summary(fun.data=mean_sdl, fun.args = list(mult = 1), 
               geom="pointrange", shape = 23, size = 1,
               show.legend = TRUE, position = position_dodge(0.9)) +
  stat_summary(fun = mean, geom = "label", aes(label = round(..y..,2)),
               size = 4, position = position_dodge(1.8), 
               alpha = 0.5, show.legend = FALSE) +
  labs(x = "Flea host", y = "Jump length in [cm]",
       fill = "Host") +
  scale_fill_viridis(discrete = TRUE, option = "plasma") +
  coord_cartesian(ylim = c(0, NA))
```

## Data availability

The data is available as txt-Files under <https://github.com/jkruppa/biodatascience>.

```{r}
#| echo: false

jump_animals_tbl |> 
  arrange(host) |> 
  mutate_if(is.numeric, round, 2) |> 
  write_delim("data/jump_animals.txt")

jump_flea_tbl |> 
  arrange(host) |> 
  mutate_if(is.numeric, round, 2) |> 
  write_delim("data/jump_fleas.txt")

jump_habitat_tbl |> 
  arrange(host, site) |> 
  mutate_if(is.numeric, round, 2) |> 
  write_delim("data/jump_habitat.txt")
```



## Alternatives 

Further tutorials and R packages on XXX

### Why linear is a bad idea?

```{r}
jump_flea_tbl <- tibble(host = rep(0:1, each = 7),
                        jump_length = 19.9 + 10.5 * host + rnorm(14, 0, 9.1)) |> 
  mutate(host = factor(host, labels = c("cat", "dog")))
```

### Why is a `tibble()` bad idea?

```{r}
jump_animals_tbl <- tibble(cat = rnorm(n = 7, mean = 19.9, sd = 9.1),
                           fox = rnorm(n = 7, mean = 35.2, sd = 10.3),
                           rat = rnorm(n = 7, mean = 15.2, sd = 4.6),
                           dog = rnorm(n = 7, mean = 30.4, sd = 9.1)) |>
  pivot_longer(cols = cat:dog, values_to = "jump_length", names_to = "host") |> 
  mutate(host = as_factor(host))
```


## Glossary

term

: what does it mean.

## The meaning of "Models of Reality" in this chapter.

- itemize with max. 5-6 words

## Summary

## References {.unnumbered}